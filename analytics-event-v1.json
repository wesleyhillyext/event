{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.yext.com/api/analytics/event",
  "$version": "1",
  "type": "object",
  "title": "Analytics Event",
  "description": "Represents an event for analytics purposes.",
  "required": [
    "action",
    "timestamp",
    "type"
  ],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "const": "https://schema.yext.com/api/analytics/event/v1"
    },
    "action": {
      "type": "string",
      "description": "The action which caused the event.",
      "enum": [
        "ADD_TO_CART",
        "APPLY",
        "BOOK",
        "COLLAPSE",
        "CUSTOM",
        "DIRECTIONS",
        "EXPAND",
        "MESSAGE",
        "ORDER",
        "PHONE",
        "SUBMIT",
        "THUMBS_UP",
        "THUMBS_DOWN",
        "TITLE",
        "WEBSITE"
      ]
    },
    "actionName": {
      "type": "string",
      "regex": "^[a-zA-Z0-9_-]{1,32}$",
      "description": "Provides additional context for the action. Typically paired with the `CUSTOM` action. `regex: \"^[a-zA-Z0-9_-]{1,32}$\"`"
    },
    "context": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "bot": {
          "description": "Whether the event is the result of bot activity.",
          "default": "$auto",
          "oneOf": [
            {
              "type": "boolean",
              "title": "boolean",
              "description": "Specifies that the event should be considered bot or not-bot traffic as indicated."
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically detect bot traffic from IP and user agent rules."
            }
          ]
        },
        "browser": {
          "default": "$auto",
          "description": "The browser associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,32}$",
              "title": "string",
              "description": "Specifies the browser for the event. `regex: \"^[\\x20-\\x7E]{1,32}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the browser from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no browser should be stored with the event."
            }
          ]
        },
        "browserVersion": {
          "default": "$auto",
          "description": "The browser version associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,32}$",
              "title": "string",
              "description": "Specifies the browser version for the event. `regex: \"^[\\x20-\\x7E]{1,32}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the browser version from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no browser version should be stored with the event."
            }
          ]
        },
        "country": {
          "default": "$auto",
          "description": "The country of the visitor for the event, as a ISO 3166-1 alpha-2 country code.",
          "oneOf": [
            {
              "type": "string",
              "minLength": 2,
              "maxLength": 2,
              "title": "ISO 3166-1 alpha-2",
              "description": "Specifies the country for the event."
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the country from the request's IP address, or the value of the `ip` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no country should be stored with the event."
            }
          ]
        },
        "destination": {
          "type": "string",
          "format": "uri",
          "title": "URL",
          "description": "The URL of the page the event is directing the user to. `format: uri`"
        },
        "device": {
          "default": "$auto",
          "description": "The device associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,64}$",
              "title": "string",
              "description": "Specifies the device for the event. `regex: \"^[\\x20-\\x7E]{1,64}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the device from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no device should be stored with the event."
            }
          ]
        },
        "deviceClass": {
          "default": "$auto",
          "description": "The class of device associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,64}$",
              "title": "string",
              "description": "Specifies the device class for the event. `regex: \"^[\\x20-\\x7E]{1,64}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the device class from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no device class should be stored with the event."
            }
          ]
        },
        "internal": {
          "type": "boolean",
          "default": "false",
          "description": "Indicates whether the event is the result of internal activity."
        },
        "ip": {
          "type": "object",
          "description": "The IP address for the event.",
          "default": {
            "address": "$auto",
            "algorithm": "HASH"
          },
          "oneOf": [
            {
              "type": "object",
              "title": "IP",
              "properties": {
                "address": {
                  "oneOf": [
                    {
                      "type": "string",
                      "format": "ipv4",
                      "title": "IPv4",
                      "description": "Specifies the IPv4 address associated with the event. `format: \"ipv4\"`"
                    },
                    {
                      "const": "$auto",
                      "title": "$auto",
                      "description": "Indicates to use the Source IP address from the IP header of the request. This IP address is only used if the `Yext-Opt-In: ip` header is present."
                    }
                  ]
                },
                "algorithm": {
                  "type": "string",
                  "enum": [
                    "HASH"
                  ],
                  "description": "The algorithm to use to anonymize the IP address after collection."
                }
              },
              "required": [
                "address",
                "algorithm"
              ],
              "additionalProperties": false
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no IP address should be associated with the event."
            }
          ]
        },
        "location": {
          "default": "$auto",
          "description": "The geographic coordinates of the visitor for the event.",
          "oneOf": [
            {
              "type": "object",
              "title": "Coordinates",
              "properties": {
                "latitude": {
                  "type": "number",
                  "minimum": -90,
                  "maximum": 90,
                  "description": "The latitude, in degrees North."
                },
                "longitude": {
                  "type": "number",
                  "minimum": -180,
                  "maximum": 180,
                  "description": "The longitude, in degrees East."
                },
                "radiusMeters": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "The accuracy radius of the coordinates, in meters."
                }
              },
              "required": [
                "latitude",
                "longitude"
              ],
              "additionalProperties": false
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the location from the request's IP address, or the value of the `ip` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no location should be stored with the event."
            }
          ]
        },
        "os": {
          "default": "$auto",
          "description": "The operating system associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,64}$",
              "title": "string",
              "description": "Specifies the operating system for the event. `regex: \"^[\\x20-\\x7E]{1,64}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the operating system from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no operating system should be stored with the event."
            }
          ]
        },
        "osVersion": {
          "default": "$auto",
          "description": "The operating system version associated with the event.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]{1,64}$",
              "title": "string",
              "description": "Specifies the operating system version for the event. `regex: \"^[\\x20-\\x7E]{1,64}$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to automatically determine the operating system version from request headers, or the value of the `userAgent` property if specified."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no operating system version should be stored with the event."
            }
          ]
        },
        "page": {
          "description": "The URL of the page the event occurred on.",
          "default": "$auto",
          "oneOf": [
            {
              "type": "string",
              "format": "uri",
              "title": "URL",
              "description": "Specifies the URL of the page the event occurred on. `format: uri`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to use the `Referer` header of the request."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no page URL should be stored with the event."
            }
          ]
        },
        "referrer": {
          "type": "string",
          "format": "uri",
          "title": "URL",
          "description": "The URL of the page which the visitor came from prior to the event."
        },
        "session": {
          "type": "string",
          "regex": "^[a-zA-Z0-9_-+/=]{1,36}$",
          "description": "Session ID for the event. `regex: \"^[a-zA-Z0-9_-+/=]{1,36}$\"`"
        },
        "userAgent": {
          "description": "The user agent string for the event.",
          "default": "$auto",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[\\x20-\\x7E]+$",
              "title": "string",
              "description": "Specifies the user agent string for the event. `regex: \"^[\\x20-\\x7E]+$\"`"
            },
            {
              "const": "$auto",
              "title": "$auto",
              "description": "Indicates to use the `User-Agent` header of the request."
            },
            {
              "type": "null",
              "title": "null",
              "description": "Specifies that no user agent should be stored with the event."
            }
          ]
        }
      }
    },
    "entity": {
      "type": "integer",
      "minimum": 1,
      "description": "The Yext entityId for the entity associated with the event."
    },
    "nonce": {
      "type": "string",
      "regex": "^[a-zA-Z0-9_-+/=]{1,36}$",
      "description": "Deduplication ID for the event. Events from the same app with the same nonce will get de-duplicated. `regex: \"^[a-zA-Z0-9_-+/=]{1,36}$\"`"
    },
    "product": {
      "description": "The product-specific properties of the event. An event can only belong to a single product (or none).",
      "oneOf": [
        {
          "type": "object",
          "title": "Conversion Tracking",
          "description": "The Conversion Tracking properties of the event. The event type must be `CONVERSION`.",
          "properties": {
            "conversions": {
              "type": "object",
              "properties": {
                "action": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 64,
                  "description": "The identifier of the conversion action triggered by the event."
                },
                "value": {
                  "type": "number",
                  "multipleOf": 0.0001,
                  "description": "The value of the conversion, in the currency of the conversion action, to override the default value of the conversion action."
                }
              },
              "required": [
                "action"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "conversions"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "title": "Listings",
          "description": "The Listings properties of the event.",
          "properties": {
            "listings": {
              "type": "object",
              "properties": {
                "publisher": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "The publisherId of the publisher associated with the event."
                },
                "source": {
                  "type": "string",
                  "regex": "^[a-zA-Z0-9_-]{1,16}$",
                  "description": "Type of page where the event took place. `regex: \"^[a-zA-Z0-9_-]{1,16}$\"`"
                },
                "target": {
                  "type": "string",
                  "regex": "^[a-zA-Z0-9_-]{1,16}$",
                  "description": "Indicates which part of the page the user clicked on. `regex: \"^[a-zA-Z0-9_-]{1,16}$\"`"
                }
              },
              "required": [
                "publisher"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "listings"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "title": "Pages",
          "description": "The Pages properties of the event.",
          "properties": {
            "pages": {
              "type": "object",
              "properties": {
                "directory": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "The directoryId."
                },
                "directoryNode": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "The directoryNodeId."
                },
                "pageSet": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "The pageSetId of the site associated with the event."
                },
                "site": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "The siteId of the site associated with the event."
                },
                "type": {
                  "enum": [
                    "LANDING_PAGES"
                  ],
                  "description": "The type of Pages implementation."
                },
                "version": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 32,
                  "description": "The version of the site."
                }
              },
              "required": [
                "site",
                "version"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "pages"
          ],
          "additionalProperties": false
        }
      ]
    },
    "tags": {
      "type": "object",
      "description": "Up to 10 custom key-value pairs to associate with the event. Property name `regex: \"^[a-zA-Z][a-zA-Z0-9_]{0,31}$\"`",
      "maxProperties": 10,
      "additionalProperties": {
        "type": "string",
        "maxLength": 64
      },
      "propertyNames": {
        "pattern": "^[a-zA-Z][a-zA-Z0-9_]{0,31}$"
      }
    },
    "timestamp": {
      "description": "The timestamp at which the event occurred.",
      "default": "$auto",
      "oneOf": [
        {
          "type": "string",
          "format": "date-time",
          "title": "ISO Timestamp",
          "description": "Specifies the timestamp at which the event occurred. `format: \"date-time\"`"
        },
        {
          "const": "$auto",
          "title": "$auto",
          "description": "Indicates to use the time when the request was received as the event timestamp."
        }
      ]
    },
    "type": {
      "type": "string",
      "enum": [
        "CLICK",
        "CONVERSION",
        "IMPRESSION",
        "VIEW"
      ],
      "description": "The basic type of the event."
    },
    "visitor": {
      "properties": {
        "id": {
          "type": "string",
          "regex": "^[\\x20-\\x7E]{1,64}$",
          "title": "string",
          "description": "Identifies the visitor associated with the event. `regex: \"^[\\x20-\\x7E]{1,64}$\"`"
        },
        "idMethod": {
          "description": "The method used to identify the visitor.",
          "oneOf": [
            {
              "type": "string",
              "regex": "^[a-zA-Z0-9_-]{1,16}$",
              "title": "string",
              "description": "Specifies how the visitor was identified. `regex: \"^[a-zA-Z0-9_-]{1,16}$\"`"
            },
            {
              "const": "Yext",
              "title": "Yext",
              "description": "Indicates that the `visitor` was authenticated by Yext and the `visitor` property is a Yext userId."
            }
          ]
        }
      },
      "required": [
        "id"
      ],
      "additionalProperties": false
    }
  }
}
